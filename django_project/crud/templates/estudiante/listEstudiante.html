{% extends 'base.html' %}
{% load static %}

{% block title %}Lista de Estudiantes{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>ğŸ‘¨â€ğŸ“ Lista de Estudiantes</h2>
    </div>

    <div id="loading" class="loading">
        <p>â³ Cargando estudiantes...</p>
    </div>

    <div id="estudiantes-container" class="hidden">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Edad</th>
                        <th>GÃ©nero</th>
                    </tr>
                </thead>
                <tbody id="estudiantes-list"></tbody>
            </table>
        </div>
    </div>

    <div id="empty-state" class="empty-state hidden">
        <h3>ğŸ“­ No hay estudiantes registrados</h3>
        <a href="{% url 'crud:estudiante_form' %}" class="btn btn-primary mt-2">â• Registrar Estudiante</a>
    </div>

    <div class="mt-3">
        <a href="{% url 'crud:menu' %}" class="btn btn-secondary">â†©ï¸ Volver al MenÃº</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'crud/js/apiService.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const loading = document.getElementById('loading');
        const container = document.getElementById('estudiantes-container');
        const emptyState = document.getElementById('empty-state');
        const tbody = document.getElementById('estudiantes-list');

        try {
            const estudiantes = await getAll('estudiantes');
            loading.classList.add('hidden');

            if (estudiantes && estudiantes.length > 0) {
                container.classList.remove('hidden');
                estudiantes.forEach(estudiante => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${estudiante.ID_ESTUDIANTE}</td>
                        <td>${estudiante.NOMBRE}</td>
                        <td>${estudiante.APELLIDO}</td>
                        <td>${estudiante.EDAD}</td>
                        <td>${estudiante.GENERO === 'M' ? 'Masculino' : estudiante.GENERO === 'F' ? 'Femenino' : 'Otro'}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } else {
                emptyState.classList.remove('hidden');
            }
        } catch (error) {
            loading.innerHTML = '<p class="alert alert-error">âŒ Error al cargar estudiantes</p>';
        }
    });
</script>
{% endblock %}