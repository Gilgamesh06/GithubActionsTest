{% extends 'base.html' %}
{% load static %}

{% block title %}Lista de Asignaturas{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>ğŸ“– Lista de Asignaturas</h2>
    </div>

    <div id="loading" class="loading">
        <p>â³ Cargando asignaturas...</p>
    </div>

    <div id="asignaturas-container" class="hidden">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>CrÃ©ditos</th>
                    </tr>
                </thead>
                <tbody id="asignaturas-list">
                </tbody>
            </table>
        </div>
    </div>

    <div id="empty-state" class="empty-state hidden">
        <h3>ğŸ“­ No hay asignaturas registradas</h3>
        <p>Comienza registrando una nueva asignatura</p>
        <a href="{% url 'crud:asignatura_form' %}" class="btn btn-primary mt-2">â• Registrar Asignatura</a>
    </div>

    <div class="mt-3">
        <a href="{% url 'crud:menu' %}" class="btn btn-secondary">â†©ï¸ Volver al MenÃº</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'crud/js/apiService.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const loading = document.getElementById('loading');
        const container = document.getElementById('asignaturas-container');
        const emptyState = document.getElementById('empty-state');
        const tbody = document.getElementById('asignaturas-list');

        try {
            const asignaturas = await getAll('asignaturas');
            loading.classList.add('hidden');

            if (asignaturas && asignaturas.length > 0) {
                container.classList.remove('hidden');

                asignaturas.forEach(asignatura => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${asignatura.ID_ASIGNATURA}</td>
                        <td>${asignatura.NOMBRE}</td>
                        <td>${asignatura.CREDITOS}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } else {
                emptyState.classList.remove('hidden');
            }
        } catch (error) {
            loading.innerHTML = '<p class="alert alert-error">âŒ Error al cargar asignaturas</p>';
        }
    });
</script>
{% endblock %}