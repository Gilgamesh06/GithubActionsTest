{% extends 'base.html' %}
{% load static %}

{% block title %}Lista de Matr√≠culas{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>üìù Lista de Matr√≠culas</h2>
    </div>

    <div id="loading" class="loading">
        <p>‚è≥ Cargando matr√≠culas...</p>
    </div>

    <div id="matriculas-container" class="hidden">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ID Estudiante</th>
                        <th>ID Curso</th>
                    </tr>
                </thead>
                <tbody id="matriculas-list"></tbody>
            </table>
        </div>
    </div>

    <div id="empty-state" class="empty-state hidden">
        <h3>üì≠ No hay matr√≠culas registradas</h3>
        <a href="{% url 'crud:matricula_form' %}" class="btn btn-primary mt-2">‚ûï Registrar Matr√≠cula</a>
    </div>

    <div class="mt-3">
        <a href="{% url 'crud:menu' %}" class="btn btn-secondary">‚Ü©Ô∏è Volver al Men√∫</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'crud/js/apiService.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const loading = document.getElementById('loading');
        const container = document.getElementById('matriculas-container');
        const emptyState = document.getElementById('empty-state');
        const tbody = document.getElementById('matriculas-list');

        try {
            const matriculas = await getAll('matriculas');
            loading.classList.add('hidden');

            if (matriculas && matriculas.length > 0) {
                container.classList.remove('hidden');
                matriculas.forEach(matricula => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${matricula.ID_MATRICULA}</td>
                        <td>${matricula.FID_ESTUDIANTE}</td>
                        <td>${matricula.FID_CURSO}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } else {
                emptyState.classList.remove('hidden');
            }
        } catch (error) {
            loading.innerHTML = '<p class="alert alert-error">‚ùå Error al cargar matr√≠culas</p>';
        }
    });
</script>
{% endblock %}