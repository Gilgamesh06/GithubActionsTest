{% extends 'base.html' %}
{% load static %}

{% block title %}Lista de Cursos{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>üéì Lista de Cursos</h2>
    </div>

    <div id="loading" class="loading">
        <p>‚è≥ Cargando cursos...</p>
    </div>

    <div id="cursos-container" class="hidden">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>ID Asignatura</th>
                        <th>ID Profesor</th>
                    </tr>
                </thead>
                <tbody id="cursos-list"></tbody>
            </table>
        </div>
    </div>

    <div id="empty-state" class="empty-state hidden">
        <h3>üì≠ No hay cursos registrados</h3>
        <a href="{% url 'crud:curso_form' %}" class="btn btn-primary mt-2">‚ûï Registrar Curso</a>
    </div>

    <div class="mt-3">
        <a href="{% url 'crud:menu' %}" class="btn btn-secondary">‚Ü©Ô∏è Volver al Men√∫</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'crud/js/apiService.js' %}"></script>
<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const loading = document.getElementById('loading');
        const container = document.getElementById('cursos-container');
        const emptyState = document.getElementById('empty-state');
        const tbody = document.getElementById('cursos-list');

        try {
            const cursos = await getAll('cursos');
            loading.classList.add('hidden');

            if (cursos && cursos.length > 0) {
                container.classList.remove('hidden');
                cursos.forEach(curso => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${curso.ID_CURSO}</td>
                        <td>${curso.NOMBRE}</td>
                        <td>${curso.FID_ASIGNATURA}</td>
                        <td>${curso.FID_PROFESOR}</td>
                    `;
                    tbody.appendChild(tr);
                });
            } else {
                emptyState.classList.remove('hidden');
            }
        } catch (error) {
            loading.innerHTML = '<p class="alert alert-error">‚ùå Error al cargar cursos</p>';
        }
    });
</script>
{% endblock %}